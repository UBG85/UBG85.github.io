var NUM_ROWS_PAGE_LEVEL=2,NUM_COLS_PAGE_LEVEL=5;function CLevelMenu(){var e,t,s,i,n,_,a,l,r,o,h,u,A,E,c,M,d=null,S=null,L=null,g=null;this._init=function(){var s=s_oMain.getMatches();if(null===s)this._extractMatches();else{s_aMatches=new Array,n=new Array;for(var f=0;f<s.length;f++){s_aMatches[f]=s[f].opponent;var v=s[f].result;if(""===v)n.push(["",""]);else{var b=v.split("-");n.push(b)}}}e=0,E=new createjs.Container,s_oStage.addChild(E);var T=createBitmap(s_oSpriteLibrary.getSprite("bg_levelselect"));E.addChild(T);var p=s_oSpriteLibrary.getSprite("msg_box"),w=createBitmap(p);w.x=CANVAS_WIDTH_HALF,w.y=CANVAS_HEIGHT_HALF+30,w.regX=.5*p.width,w.regY=.5*p.height,E.addChild(w);var O=new createjs.Text(TEXT_MATCHES,"50px "+PRIMARY_FONT,TEXT_COLOR);O.x=CANVAS_WIDTH_HALF,O.y=80,O.textAlign="center",O.textBaseline="alphabetic",O.shadow=new createjs.Shadow("#000000",2,2,4),E.addChild(O);var C=s_oSpriteLibrary.getSprite("but_exit");a={x:CANVAS_WIDTH-C.height/2-10,y:C.height/2+10},(u=new CGfxButton(a.x,a.y,C,s_oStage)).addEventListener(ON_MOUSE_UP,this._onExit,this),t=C.height,!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(l={x:u.getX()-C.width-10,y:C.height/2+10},(A=new CToggle(l.x,l.y,s_oSpriteLibrary.getSprite("audio_icon"),s_bAudioActive)).addEventListener(ON_MOUSE_UP,this._onAudioToggle,this));var N=window.document,y=N.documentElement;L=y.requestFullscreen||y.mozRequestFullScreen||y.webkitRequestFullScreen||y.msRequestFullscreen,g=N.exitFullscreen||N.mozCancelFullScreen||N.webkitExitFullscreen||N.msExitFullscreen,!1===ENABLE_FULLSCREEN&&(L=!1),L&&screenfull.enabled&&(C=s_oSpriteLibrary.getSprite("but_fullscreen"),h={x:C.width/4+10,y:a.y},(M=new CToggle(h.x,h.y,C,s_bFullscreen,s_oStage)).addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this)),this._checkBoundLimits(),i=new Array;var H=CANVAS_WIDTH+EDGEBOARD_X,x=Math.floor(H/NUM_COLS_PAGE_LEVEL)/2,D=.7*-EDGEBOARD_X;for(f=0;f<NUM_COLS_PAGE_LEVEL;f++)i.push(D),D+=x;if(_=new Array,this._createNewLevelPage(0,NUM_MATCHES),_.length>1){for(var U=1;U<_.length;U++)_[U].visible=!1;r={x:CANVAS_WIDTH-180,y:CANVAS_HEIGHT_HALF},(d=new CGfxButton(r.x,r.y,s_oSpriteLibrary.getSprite("arrow_right"),s_oStage)).addEventListener(ON_MOUSE_UP,this._onRight,this),o={x:180,y:CANVAS_HEIGHT_HALF},(S=new CGfxButton(o.x,o.y,s_oSpriteLibrary.getSprite("arrow_left"),s_oStage)).addEventListener(ON_MOUSE_UP,this._onLeft,this)}(c=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),s_oStage.addChild(c),createjs.Tween.get(c).to({alpha:0},1e3).call((function(){s_oStage.removeChild(c),c=null})),this.refreshButtonPos(s_iOffsetX,s_iOffsetY)},this.unload=function(){for(var e=0;e<s.length;e++)s[e].unload();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(A.unload(),A=null),L&&screenfull.enabled&&M.unload(),u.unload(),u=null,null!==S&&(S.unload(),d.unload()),s_oLevelMenu=null,s_oStage.removeAllChildren()},this.refreshButtonPos=function(){u.setPosition(a.x-s_iOffsetX,a.y+s_iOffsetY),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||A.setPosition(l.x-s_iOffsetX,s_iOffsetY+l.y),L&&screenfull.enabled&&M.setPosition(h.x+s_iOffsetX,h.y+s_iOffsetY)},this._extractMatches=function(){s_aMatches=new Array,n=new Array;for(var e=4;e>0;){var t=Math.floor(Math.random()*EASY_TEAM.length);EASY_TEAM[t]!==s_iTeamSelected&&(s_aMatches.push(EASY_TEAM[t]),s_oMain.saveMatch(s_aMatches.length,EASY_TEAM[t],"",0,0),e--,EASY_TEAM.splice(t,1),n.push(["",""]))}for(e=3;e>0;){t=Math.floor(Math.random()*MEDIUM_TEAM.length);MEDIUM_TEAM[t]!==s_iTeamSelected&&(s_aMatches.push(MEDIUM_TEAM[t]),s_oMain.saveMatch(s_aMatches.length,MEDIUM_TEAM[t],"",0,0),e--,MEDIUM_TEAM.splice(t,1),n.push(["",""]))}for(e=3;e>0;){t=Math.floor(Math.random()*HARD_TEAM.length);HARD_TEAM[t]!==s_iTeamSelected&&(s_aMatches.push(HARD_TEAM[t]),s_oMain.saveMatch(s_aMatches.length,HARD_TEAM[t],"",0,0),e--,HARD_TEAM.splice(t,1),n.push(["",""]))}},this._checkBoundLimits=function(){for(var e=s_oSpriteLibrary.getSprite("but_level"),s=0,i=CANVAS_HEIGHT-2*EDGEBOARD_Y-2*t,n=0;s<i;)s+=e.height+20,n++;NUM_ROWS_PAGE_LEVEL>n&&(NUM_ROWS_PAGE_LEVEL=n);var _=0,a=0,l=CANVAS_WIDTH-2*EDGEBOARD_X;for(e=s_oSpriteLibrary.getSprite("but_level");a<l;)a+=e.width/2+5,_++;NUM_COLS_PAGE_LEVEL>_&&(NUM_COLS_PAGE_LEVEL=_)},this._createNewLevelPage=function(e,t){var a=new createjs.Container;E.addChild(a),_.push(a),s=new Array;for(var l=0,r=50,o=1,h=!1,u=s_oSpriteLibrary.getSprite("but_level"),A=e;A<t;A++){var c=new CLevelBut(i[l]+u.width/2,r+u.height/2,s_aMatches[A],n[A],A+1,u,!(A+1>s_iLastLevel),a);if(c.addEventListenerWithParams(ON_MOUSE_UP,this._onButLevelRelease,this,A+1),s.push(c),++l===i.length&&(l=0,r+=u.height+50,++o>NUM_ROWS_PAGE_LEVEL&&A<t-1)){h=!0;break}}a.x=CANVAS_WIDTH/2+u.width/2,a.y=CANVAS_HEIGHT/2,a.regX=a.getBounds().width/2,a.regY=a.getBounds().height/2,h&&this._createNewLevelPage(A+1,t)},this._onRight=function(){_[e].visible=!1,++e>=_.length&&(e=0),_[e].visible=!0},this._onLeft=function(){_[e].visible=!1,--e<0&&(e=_.length-1),_[e].visible=!0},this._onButLevelRelease=function(e){s_oLevelMenu.unload(),s_oMain.gotoGame(e)},this._onAllImagesLoaded=function(){s_oLevelMenu.unload(),s_oMain.gotoGame(undefined)},this._onAudioToggle=function(){Howler.mute(s_bAudioActive),s_bAudioActive=!s_bAudioActive},this._onExit=function(){this.unload(),s_oMain.gotoMenu()},this.resetFullscreenBut=function(){L&&screenfull.enabled&&M.setActive(s_bFullscreen)},this._onFullscreenRelease=function(){s_bFullscreen?g.call(window.document):L.call(window.document.documentElement),sizeHandler()},s_oLevelMenu=this,this._init()}var s_oLevelMenu=null;