function CMenu(){var e,t,o,i,n,s,l,a,_,r,u,c,g,S,d,h,M=null,E=null;this._init=function(){a=createBitmap(s_oSpriteLibrary.getSprite("bg_menu")),s_oStage.addChild(a),t={x:CANVAS_WIDTH/2+80,y:CANVAS_HEIGHT-100};var l=s_oSpriteLibrary.getSprite("but_local");(_=new CGfxButton(t.x,t.y,l,s_oStage)).addEventListener(ON_MOUSE_UP,this._onButLocalRelease,this),o={x:CANVAS_WIDTH/2+350,y:CANVAS_HEIGHT-100};l=s_oSpriteLibrary.getSprite("but_multiplayer");if((r=new CGfxButton(o.x,o.y,l,s_oStage)).addEventListener(ON_MOUSE_UP,this._onButMultiplayerRelease,this),!1===DISABLE_SOUND_MOBILE||!1===s_bMobile){l=s_oSpriteLibrary.getSprite("audio_icon");e={x:CANVAS_WIDTH-l.height/2-10,y:l.height/2+10},(d=new CToggle(e.x,e.y,l,s_bAudioActive)).addEventListener(ON_MOUSE_UP,this._onAudioToggle,this)}var T=window.document,b=T.documentElement;M=b.requestFullscreen||b.mozRequestFullScreen||b.webkitRequestFullScreen||b.msRequestFullscreen,E=T.exitFullscreen||T.mozCancelFullScreen||T.webkitExitFullscreen||T.msExitFullscreen,!1===ENABLE_FULLSCREEN&&(M=!1);var A=s_oSpriteLibrary.getSprite("but_info");i={x:A.height/2+10,y:A.height/2+10},(u=new CGfxButton(i.x,i.y,A,s_oStage)).addEventListener(ON_MOUSE_UP,this._onButInfoRelease,this),u.setVisible(!1),M&&screenfull.enabled&&(l=s_oSpriteLibrary.getSprite("but_fullscreen"),n={x:i.x+l.width/2+10,y:l.height/2+10},(h=new CToggle(n.x,n.y,l,s_bFullscreen,s_oStage)).addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));l=s_oSpriteLibrary.getSprite("but_delete_savings");s={x:l.width/2+10,y:CANVAS_HEIGHT-l.height/2-10},(c=new CGfxButton(s.x,s.y,l,s_oStage)).addEventListener(ON_MOUSE_UP,this._onDeleteSavings,this),null===s_oMain.getStoredTeamSelected()&&c.setVisible(!1);l=s_oSpriteLibrary.getSprite("logo");var C=createBitmap(l);C.regX=l.width/2,C.regY=l.height/2,C.x=CANVAS_WIDTH/2,C.y=CANVAS_HEIGHT/2-150,s_oStage.addChild(C),(g=new CAreYouSurePanel(s_oStage)).addEventListener(ON_BUT_YES_DOWN,this._onConfirmDelete,this),(S=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),s_oStage.addChild(S),createjs.Tween.get(S).to({alpha:0},1e3).call((function(){S.visible=!1})),s_bStorageAvailable||new CMsgBox(TEXT_ERR_LS,s_oStage),this.refreshButtonPos(s_iOffsetX,s_iOffsetY)},this.refreshButtonPos=function(l,a){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||d.setPosition(e.x-l,a+e.y),M&&screenfull.enabled&&h.setPosition(n.x+l,n.y+a),u.setPosition(i.x+l,i.y+a),c.setPosition(s.x+l,s.y-a),_.setPosition(t.x,t.y-a),r.setPosition(o.x,o.y-a)},this.unload=function(){_.unload(),_=null,r.unload(),r=null,!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(d.unload(),d=null),M&&screenfull.enabled&&h.unload(),c.unload(),g.unload(),s_oStage.removeAllChildren(),clearTimeout(l),s_oMenu=null},this._onAudioToggle=function(){Howler.mute(s_bAudioActive),s_bAudioActive=!s_bAudioActive},this._onButInfoRelease=function(){new CCreditsPanel},this.resetFullscreenBut=function(){M&&screenfull.enabled&&h.setActive(s_bFullscreen)},this._onFullscreenRelease=function(){s_bFullscreen?E.call(window.document):M.call(window.document.documentElement),sizeHandler()},this._onDeleteSavings=function(){g.show(TEXT_CONFIRM_DELETE)},this._onConfirmDelete=function(){s_iLastLevel=1,clearAllItem(),c.setVisible(!1)},this._onButLocalRelease=function(){s_bMultiplayer=!1,s_bPlayWithBot=!1,$(s_oMain).trigger("start_session"),this.unload(),null===s_oMain.getStoredTeamSelected()?s_oMain.gotoSelectTeam():(s_iTeamSelected=s_oMain.getStoredTeamSelected(),s_iLastLevel=s_oMain.getLastLevel(),s_oMain.gotoLevelPanel())},this._onButMultiplayerRelease=function(){$(s_oMain).trigger("start_session"),s_bMultiplayer=!0,s_bPlayWithBot=!1,s_oNetworkManager.addEventListener(ON_GAMEROOM_CONNECTION_SUCCESS,this._onGameStart),s_oNetworkManager.addEventListener(ON_MATCHMAKING_CONNECTION_SUCCESS,this._onMatchmakingConnected),s_oNetworkManager.connectToSystem()},this.onRemoteGameStart=function(){g_oCTLMultiplayer.closeAllDialog(),s_bMultiplayer=!0,s_bPlayWithBot=!1,s_oMenu.unload(),s_oMain.gotoSelectTeamMulti()},this._onGameStart=function(){l=setTimeout((function(){g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(TEXT_OPPONENT_LEFT,"s_oNetworkManager.gotoLobby"),s_oNetworkManager.disconnect()}),WAITING_PLAYERS_TIMEOUT)},this._onMatchmakingConnected=function(){g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showLoading(TEXT_FIND_OPPONENT,"s_oNetworkManager._onDisconnectFromARoom")},this._checkMatchWithBot=function(){var e=randomFloatBetween(18e3,26e3);l=setTimeout((function(){s_bMultiplayer=!0,s_bPlayWithBot=!0,g_oCTLMultiplayer.closeAllDialog(),s_oNetworkManager.disconnect(),s_oNetworkManager.generateRandomName(),s_oMenu.unload(),s_oMain.gotoSelectTeamMulti()}),e)},this.clearBotCheck=function(){clearTimeout(l)},this.onPlayOffline=function(){this._onButLocalRelease(),g_oCTLMultiplayer.closeAllDialog()},s_oMenu=this,this._init()}var s_oMenu=null;